<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DeTrusty as a Service &mdash; DeTrusty 0.15.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Changelog" href="changelog.html" />
    <link rel="prev" title="DeTrusty as a Library" href="library.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.15.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="source_description.html">Source Descriptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="decomposition.html">Decomposition Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="library.html">DeTrusty as a Library</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">DeTrusty as a Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#local-source-code">Local Source Code</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dockerhub">DockerHub</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-detrusty">Setting up DeTrusty</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#creating-updating-source-descriptions">Creating/Updating Source Descriptions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#web-interface">Web Interface</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#web-interface-executing-queries">Web Interface: Executing Queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#web-interface-plotting-query-plans">Web Interface: Plotting Query Plans</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#restful-api">RESTful API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#api-detrusty-version">API: DeTrusty Version</a></li>
<li class="toctree-l3"><a class="reference internal" href="#api-executing-queries">API: Executing Queries</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">DeTrusty</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>DeTrusty as a Service</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p><a class="reference external" href="https://hub.docker.com/r/sdmtib/detrusty"><img alt="docker" src="https://img.shields.io/badge/Docker%20Image-sdmtib/detrusty-blue?logo=Docker" /></a></p>
<section id="detrusty-as-a-service">
<h1>DeTrusty as a Service<a class="headerlink" href="#detrusty-as-a-service" title="Permalink to this heading"></a></h1>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading"></a></h2>
<p>If you want to run DeTrusty as a service, you can build the Docker image from its source code or download the Docker image from DockerHub.</p>
<section id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h3>
<p>DeTrusty is implemented in Python3. The current version of DeTrusty supports <img alt="python" src="https://img.shields.io/pypi/pyversions/DeTrusty" />.
DeTrusty uses the <code class="docutils literal notranslate"><span class="pre">requests</span></code> library for managing the HTTP(S) requests to the SPARQL endpoints.
The SPARQL parser uses <code class="docutils literal notranslate"><span class="pre">ply</span></code>.
The generation of the source descriptions from RML mappings is enabled by <code class="docutils literal notranslate"><span class="pre">rdflib</span></code>.
The Web interface is powered by <code class="docutils literal notranslate"><span class="pre">flask</span></code> and the JavaScript library <code class="docutils literal notranslate"><span class="pre">YASGUI</span></code>.
DeTrusty uses <code class="docutils literal notranslate"><span class="pre">gunicorn</span></code> as a Web server.
In order to run DeTrusty as a service, you need to have <a class="reference external" href="https://docs.docker.com/engine/install/">Docker</a> installed.</p>
</section>
<section id="local-source-code">
<h3>Local Source Code<a class="headerlink" href="#local-source-code" title="Permalink to this heading"></a></h3>
<p>You can install DeTrusty from your local source code by performing the following steps.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:SDM-TIB/DeTrusty.git
<span class="nb">cd</span><span class="w"> </span>DeTrusty
docker<span class="w"> </span>build<span class="w"> </span>.<span class="w"> </span>-t<span class="w"> </span>sdmtib/detrusty
</pre></div>
</div>
</section>
<section id="dockerhub">
<h3>DockerHub<a class="headerlink" href="#dockerhub" title="Permalink to this heading"></a></h3>
<p>The easiest way to install DeTrusty is to download the package from PyPI:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>pull<span class="w"> </span>sdmtib/detrusty:latest
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following examples assume that you cloned the repository, the current working directory is the root directory of the repository, and Docker is installed.</p>
</div>
</section>
</section>
<section id="setting-up-detrusty">
<h2>Setting up DeTrusty<a class="headerlink" href="#setting-up-detrusty" title="Permalink to this heading"></a></h2>
<p>As stated in the note above, this example assumes that you cloned the repository of DeTrusty, the current working directory is the root directory of the repository, and Docker is installed.
If all that is true, you can start your own instance of DeTrusty by executing the following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose<span class="w"> </span>-f<span class="w"> </span>example/docker-compose.yml<span class="w"> </span>up<span class="w"> </span>-d
</pre></div>
</div>
<section id="creating-updating-source-descriptions">
<h3>Creating/Updating Source Descriptions<a class="headerlink" href="#creating-updating-source-descriptions" title="Permalink to this heading"></a></h3>
<p>The example loaded the source descriptions for the K4COVID federation.
If you want to update the source descriptions, create a file <code class="docutils literal notranslate"><span class="pre">/DeTrusty/Config/endpoints.txt</span></code> inside your Docker container.
This file should contain the URLs to the SPARQL endpoints you want to be included in your federation.
Put one URL per line and execute the following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>DeTrusty<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;create_rdfmts.py -s /DeTrusty/Config/endpoints.txt&#39;</span>
</pre></div>
</div>
<p>After the new source description file was generated as <code class="docutils literal notranslate"><span class="pre">/DeTrusty/Config/rdfmts.json</span></code>, you need to restart the <code class="docutils literal notranslate"><span class="pre">gunicorn</span></code> workers in order for the changes to take effect.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>DeTrusty<span class="w"> </span>restart_workers.sh
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also make use of the more advanced options described in <a class="reference internal" href="library.html#id3"><span class="std std-ref">Creating Source Descriptions</span></a>.
In that case, your endpoints file should contain a JSON string matching with the input of the mentioned examples.
Additionally, the <code class="docutils literal notranslate"><span class="pre">-j</span></code> flag needs to be set.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>DeTrusty<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;create_rdfmts.py -s /DeTrusty/Config/endpoints.json -j&#39;</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="web-interface">
<h2>Web Interface<a class="headerlink" href="#web-interface" title="Permalink to this heading"></a></h2>
<p>After setting up DeTrusty as described above, you can start using DeTrusty’s Web interface.
In this example, the interface is accessible with the base URL <a class="reference external" href="localhost:5000">localhost:5000</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the Web interface returns a <em>“404 - File not found”</em> if you try to access a route which is not specified.</p>
</div>
<section id="web-interface-executing-queries">
<h3>Web Interface: Executing Queries<a class="headerlink" href="#web-interface-executing-queries" title="Permalink to this heading"></a></h3>
<p>Thanks to <code class="docutils literal notranslate"><span class="pre">YASGUI</span></code>, you can post your queries to DeTrusty from your favorite Web browser by navigating to <code class="docutils literal notranslate"><span class="pre">https://your_domain.tld/sparql</span></code>, i.e., in this example, use <a class="reference external" href="localhost:5000/sparql">localhost:5000/sparql</a>.
Just enter your query and hit the button.</p>
</section>
<section id="web-interface-plotting-query-plans">
<h3>Web Interface: Plotting Query Plans<a class="headerlink" href="#web-interface-plotting-query-plans" title="Permalink to this heading"></a></h3>
<p>When running DeTrusty as a service, you can also plot the query plan of your queries via the Web interface.
The path is <code class="docutils literal notranslate"><span class="pre">https://your_domain.tld/query_plan</span></code>, i.e., in this example, it is <a class="reference external" href="localhost:5000/query_plan">localhost:5000/query_plan</a>.
Simply enter your query and hit the button.
The current version of the interface does not allow to specify the decomposition type.
A star-shaped decomposition is assumed for the query plan generation.</p>
</section>
</section>
<section id="restful-api">
<h2>RESTful API<a class="headerlink" href="#restful-api" title="Permalink to this heading"></a></h2>
<p>DeTrusty also offers an API for executing your queries via POST requests.
The base URL in this example is <a class="reference external" href="localhost:5000">localhost:5000</a>.</p>
<section id="api-detrusty-version">
<h3>API: DeTrusty Version<a class="headerlink" href="#api-detrusty-version" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">/version</span></code> returns the version number of DeTrusty.</p>
<p>Example call:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>localhost:5000/version
</pre></div>
</div>
<p>Example output:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>DeTrusty v0.12.3
</pre></div>
</div>
</section>
<section id="api-executing-queries">
<h3>API: Executing Queries<a class="headerlink" href="#api-executing-queries" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">/sparql</span></code> executes the posted SPARQL query and returns the result as a JSON response.</p>
<p>Example call:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>-d<span class="w"> </span><span class="s2">&quot;query=SELECT DISTINCT ?covidDrug WHERE { ?treatment &lt;http://research.tib.eu/covid-19/vocab/hasCovidDrug&gt; ?covidDrug . } LIMIT 3&quot;</span><span class="w"> </span>localhost:5000/sparql
</pre></div>
</div>
<p>Example result:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;cardinality&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;execution_time&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">0.07238245010375977</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;head&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;vars&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="s2">&quot;covidDrug&quot;</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;output_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;results&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;bindings&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;__meta__&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;is_verified&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;covidDrug&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uri&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://research.tib.eu/covid-19/entity/DB00207&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;__meta__&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;is_verified&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;covidDrug&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uri&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://research.tib.eu/covid-19/entity/DB00381&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;__meta__&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;is_verified&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="nt">&quot;covidDrug&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">          </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uri&quot;</span><span class="p">,</span>
<span class="w">          </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://research.tib.eu/covid-19/entity/DB00503&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cardinality</span></code> is the number (integer) of results retrieved</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">execution_time</span></code> (float) gives the time in seconds the query engine has spent collecting the results</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">output_version</span></code> (string) indicates the version number of the output format, i.e., to differentiate the current output from possibly changed output in the future</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">variables</span></code> (list) returns a list of the variables found in the query</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">result</span></code> is a list of dictionaries containing the results of the query, using the variables as keys;
metadata about the result verification is included in the key <code class="docutils literal notranslate"><span class="pre">__meta__</span></code>.
The current version returns all results as verified as can be seen in the key <code class="docutils literal notranslate"><span class="pre">is_verified</span></code> of the metadata.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="library.html" class="btn btn-neutral float-left" title="DeTrusty as a Library" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="changelog.html" class="btn btn-neutral float-right" title="Changelog" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-2023, Philipp D. Rohde, Avellino and Mazen Bechara.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>